<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" /> -->
    <title>edYoucator</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="user.js"></script>
    <script src="quiz.js"></script>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      .joke-item {
          margin: 10px 0;
          padding: 15px;
          border: 1px solid #ddd;
          border-radius: 5px;
          background-color: #f9f9f9;
      }
  </style>
  </head>
  <body>
    <div class="menu">
      <div class="container">
        <div id="navbar" class="navbar-collapse collapse">
          <form class="navbar-form navbar-right">
            <div class="form-group">
              <input id="username" type="text" placeholder="username" class="form-control" />
            </div>
            <div class="form-group">
              <input
                type="password"
                id="password"
                placeholder="Password"
                class="form-control"
              />
            </div>
            <button id="signin-submit" type="submit" class="btn btn-success">Sign in</button>
            <button id="register" class="btn btn-success">New user</button>
          </form>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="submenu">
        <img class="logo" width="20%" src="images/logo_ed.PNG"></img>
        

    </div>
      <div class="mainarea">
        <h4>Welcome to <span class="edu">edYOUcator</span></h4>
        <p>description...</p>
        <p>
          Welcome to Edyoucator, the innovative quizzing platform that 
          empowers users to become educators by creating and sharing quizzes 
          with a global audience. Edyoucator is not just a platform; it's a 
          community-driven space where knowledge knows no bounds. Whether 
          you're a teacher looking to engage your students, a subject matter 
          expert wanting to share your expertise, or simply an enthusiast 
          eager to challenge others with your unique quiz ideas, Edyoucator is 
          the stage where learning meets fun.
        </p>
      </div>
      <div id="jokes-container"></div>
    </div>

    <div class="footer"></div>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"
      integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd"
      crossorigin="anonymous"
    ></script>
    <script>
      var user ={
        userID: "",
        password: "",
        username: "",
        firstname: "",
        lastname: "",
        dateofbirth: "",
        email: "",
        city: "",
        state: "",
        country: ""
      };
      $(function () {
        $("#signin-submit").click(async function(e) {
          e.preventDefault();
          user.userID = $('#username').val();
          user.password = $('#password').val();

          // Check if either the username or password is empty
          if (!username || !password) {
            // display alert
            alert('Please enter both user name and password')
            return;
          }
          
          
          $.ajax({
                method: 'POST',
                url: 'http://localhost:3000/cred',

                dataType: "json",
                data: JSON.stringify({
                userID: user.userID, 
                password: user.password
                }),
                headers: {'Content-Type': 'application/json', //must be double quoted
                          // 'userID': userID
                },

                // contentType: 'application/json',  //attrib of header
                success: function(result) {
                  console.log("log in success");
                  // fetchUserInfo(userId);
                },
                error: function(jqXHR) {
                    console.error('Error: ', jqXHR.responseText);
                    console.log("error from authentication");
                }
            }).done(function(result) {
              user=result.result[0];
              console.log('user:');
              console.log(user);
              const done = $('<p id="welcome-user">Welcome!' + user.firstname + '</p><div id="table-container"></div>');
              const quizDiv = $('<div id="quizdiv"></div>');
              const takeAquiz = $('<button id="takequiz"class="btn btn-success">Take a Quiz</button>');
              const myquiz = $('<button id="myquiz"class="btn btn-success">My Quiz</button>');
              

              // console.log(result);
              $(".mainarea").empty();
              $(".mainarea").append(done);
              $(".mainarea").append(quizDiv);
              $("#quizdiv").append(myquiz);
              $("#quizdiv").append(takeAquiz);
              // $(".mainarea").append(takeAquiz);
              // const name = result.result[0][0];
              // const password = result.result[0][1];
              // console.log(result.result[0].email);
              
              const ptable = $('<table>').addClass('profile-table');
              var profileTable = $('#table-container').append(generateProfileTable(ptable,user));
            });
            
            function generateProfileTable(table,twoColumnData) {
              const tbody = $('<tbody>').appendTo(table);
              $.each(twoColumnData, function (key, value) {
                const tableRow = $('<tr>').appendTo(tbody);
                $('<td style="color: rgb(95, 234, 234)">').text(key).appendTo(tableRow);
                $('<td>').text(value).appendTo(tableRow);
              });
              return table;
            }
        });

        $("#myquiz").click(async function(e) {
          e.preventDefault();
          $(".mainarea").empty();
          // $.ajax({
          //       method: 'GET',
          //       url: 'http://localhost:3000/quizid',
          //       dataType: "json",
          //       data: JSON.stringify({
          //       userID: user.userID,
          //       }),
          //       headers: {'Content-Type': 'application/json', //must be double quoted
          //       },
          //       // contentType: 'application/json',  //attrib of header
          //       success: function(result) {
          //         console.log("quizid success");
          //         // fetchUserInfo(userId);
          //       },
          //       error: function(jqXHR) {
          //           console.error('Error: ', jqXHR.responseText);
          //           console.log("error retrieving my quiz info");
          //       }
          //   }).done(function(result) {
          //     user.quizmade=result.result[0];
          //     console.log(user.quizmade);
              
          //   });

        });
        $("#regsubmit").on("submit", "#registrationForm", function(e) {
          e.preventDefault();
          $(".mainarea").empty();
          const done = $('<h3>Form submitted</h3>')
          $(".mainarea").append(done);
          console.log("Form submitted!");
        });
        $("#register").on("click", function (event) {
          event.preventDefault();
          console.log("test");
          $(".mainarea").empty();
          var form = $(
            '<form id="registationForm">\
            <h4>New User Registration Form:</h4>\
            <input type="text" id="username" placeholder="username" name="username" /><br /><br />\
            <input type="text" id="password" placeholder="password" name="password" />\
            <h4>Full Name</h4>\
            <input type="firstname" id="firstname" placeholder="first" name="firstname" /><br /><br />\
            <input type="lastname" id="lastname" placeholder="last" name="lastname" /><br /><br />\
            <input type="text" id="email" placeholder="email" name="email" /><br /><br />\
            <button id="regsubmit" type="submit" class="btn btn-success">Submit</button>\
            </form>'
          );
          $(".mainarea").append(form);
        });

      });

      $(document).ready(function() {
        //Function to fetch jokes
        function fetchJokes() {
            var limit = 3; // Number of jokes to fetch
            $.ajax({
                method: 'GET',
                url: 'https://api.api-ninjas.com/v1/jokes?limit=' + limit,
                headers: { 'X-Api-Key': '0BI4NI5+3KhmmY/QKHQoXg==7VZdDd3l59a9d20b'},
                contentType: 'application/json',
                success: function(result) {
                    displayJokes(result);
                },
                error: function(jqXHR) {
                    console.error('Error: ', jqXHR.responseText);
                }
            });
        }

        // Function to display jokes
        function displayJokes(jokes) {
            var jokesHtml = jokes.map(function(joke) {
                return '<div class="joke-item">' + joke.joke + '</div>'; // Format each joke
            }).join('');

            $('#jokes-container').html(jokesHtml); // Insert jokes into the designated container
        }

        // Fetch and display jokes when the page loads
        // fetchJokes();  //turning off to save quota

        

    });

    
    </script>
  </body>
</html>
